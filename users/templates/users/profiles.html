{% extends 'main/layout.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block css_styles %}
<style>
    #imageScrollContainer::-webkit-scrollbar {
        display: none;
        /* Hide scroll on WebKit (Chrome, Safari) */
    }

    #imageScrollContainer {
        -ms-overflow-style: none;
        /* IE and Edge */
        scrollbar-width: none;
        /* Firefox */
    }
</style>
{% endblock css_styles %}


{% block contents %}
<div class="container mt-5">
    <div class="container">
        <header>
            <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}"
                            class="link-dark link-underline-opacity-0">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Profile</li>
                </ol>
            </nav>
        </header>
    </div>

    <div class="fw-bold text-center h5">MANAGE INFORMATION 
        <a class="btn btn-sm btn-primary" href="{% url 'update-user' %}"><i class="bi bi-pencil"></i></a>
    </div>

    <div class="row">
        <div class="col-lg-4 mt-2">
            <div class="card rounded-0">
                <div class="card-body">
                    <div class="card-title fw-bold text-center">
                        INFORMATION
                    </div>
                    <table class="table table-striped table-bordered table-sm small">
                        <tr>
                            <th>Name</th>
                            <td>{{ shop.name }}</td>
                        </tr>
                        <tr>
                            <th>Owner</th>
                            <td>{{ shop.owner }}</td>
                        </tr>
                        <tr>
                            <th>Contact</th>
                            <td>{{ shop.contact }}</td>
                        </tr>
                        <tr>
                            <th>Center</th>
                            <td>{{ shop.center }}</td>
                        </tr>
                    </table>

                </div>
            </div>
        </div>

        <div class="col-lg-4 mt-2">
            <div class="card rounded-0">
                <div class="card-body">
                    <div class="card-title fw-bold text-center">
                        ADDRESS
                    </div>
                    <table class="table table-striped table-bordered table-sm small">
                        <tr>
                            <th>Municipality</th>
                            <td>{{ shop.municipality }}</td>
                        </tr>
                        <tr>
                            <th>Post Administrative</th>
                            <td>{{ shop.administrativepost }}</td>
                        </tr>
                        <tr>
                            <th>Village</th>
                            <td>{{ shop.village }}</td>
                        </tr>
                        <tr>
                            <th>Aldeia</th>
                            <td>{{ shop.aldeia }}</td>
                        </tr>
                    </table>

                </div>
            </div>
        </div>

        <div class="col-lg-4 mt-2">
            <div class="card rounded-0">
                <div class="card-body">
                    <div class="card-title fw-bold text-center">
                        KIND OF CHANNEL
                    </div>
                    <table class="table table-striped table-bordered table-sm small">

                        {% for channel in shop.kind_of_channel.all %}
                        <tr>
                            <td>{{ channel.name }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td>Don't Sell</td>
                        </tr>
                        {% endfor %}



                    </table>

                </div>
            </div>
            
        </div>
    </div>

    <div class="card rounded-0 mt-2">
        <div class="card-header fw-bold d-flex justify-content-between align-items-center">
            <span>MAP LOCATION</span>
            <div class="d-flex gap-2">
                <a class="btn border-0 rounded-4" href="{% url 'update-user-map' %}">
                    <i class="bi bi-pencil" style="font-size: 1.25rem;"></i>
                </a>
                <a class="btn border-0 rounded-4" href="https://maps.google.com/?q={{shop.latitude}},{{shop.longitude}}"
                    target="_blank">
                    <i class="bi bi-sign-turn-right" style="font-size: 1.25rem;"></i>
                </a>
            </div>
        </div>
        <div class="">
            <div class="">
                <div id="map" class="rounded-0"></div>
            </div>
        </div>
    </div>

    <div class="card rounded-0 mt-2">
        <div class="card-header fw-bold d-flex justify-content-between align-items-center">
            <span>Image ({{shop_images|length}})</span>
            <div class="d-flex gap-2">
                <a class="btn border-0 rounded-4" href="{% url 'add-image-user' %}">
                    <i class="bi bi-plus-lg" style="font-size: 1.25rem;"></i>
                </a>
            </div>
        </div>
        <div class="card-body">
            <div class="position-relative">
                <!-- Scrollable row -->
                <div id="imageScrollContainer" class="d-flex overflow-auto px-2 mx-4"
                    style="scroll-behavior: smooth; gap: 1rem;">
                    {% for image in shop_images %}
                    <div class="flex-shrink-0" style="width: 200px;">
                        <img src="{{ image.image.url }}" class="img-fluid rounded-0" loading="lazy"
                            style="height: 200px; object-fit: cover; display: block; cursor: pointer;"
                            alt="Image {{ forloop.counter }}" data-bs-toggle="modal" data-bs-target="#imageModal"
                            data-bs-slide-to="{{ forloop.counter0 }}">
                    </div>
                    {% endfor %}
                </div>

                <!-- Buttons -->
                <div class="d-flex justify-content-between mt-2">
                    <button onclick="scrollGalleryLeft()"
                        class="btn border-0 position-absolute top-50 start-0 translate-middle-y"
                        style="z-index: 10;"><i class="bi bi-chevron-left" style="font-size: 2rem; color: black;"></i></button>
                    <button onclick="scrollGalleryRight()"
                        class="btn border-0 position-absolute top-50 end-0 translate-middle-y"
                        style="z-index: 10;"><i class="bi bi-chevron-right" style="font-size: 2rem; color: black;"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark rounded-0">
            <div class="modal-body p-0">
                <div id="carouselImages" class="carousel slide" data-bs-interval="false" data-bs-ride="false">
                    <div class="carousel-inner">
                        {% for image in shop_images %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ image.image.url }}" class="img-fluid w-100"
                                style="max-height: 90vh; object-fit: contain;" alt="">
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselImages"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselImages"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                    <div class="text-center text-white py-2">
                        <span id="carouselCounter">1 of {{ shop_images|length }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock contents %}


{% block scripts %}
<script type="text/javascript">{% include 'custom/js/mapDetail.js' %}</script>
<script>
    const modal = document.getElementById('imageModal');
    modal.addEventListener('show.bs.modal', function (event) {
        const img = event.relatedTarget;
        const slideTo = img.getAttribute('data-bs-slide-to');
        const carousel = bootstrap.Carousel.getInstance(document.getElementById('carouselImages'));
        if (carousel) {
            carousel.to(parseInt(slideTo));
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const carousel = document.getElementById('carouselImages');
        const counter = document.getElementById('carouselCounter');
        const total = carousel.querySelectorAll('.carousel-item').length;

        carousel.addEventListener('slid.bs.carousel', function () {
            const activeIndex = carousel.querySelector('.carousel-item.active');
            const index = Array.from(activeIndex.parentNode.children).indexOf(activeIndex) + 1;
            counter.textContent = `${index} of ${total}`;
        });
    });
</script>

<script>
    const scrollContainer = document.getElementById('imageScrollContainer');

    function scrollGalleryLeft() {
        scrollContainer.scrollBy({ left: -250, behavior: 'smooth' });
    }

    function scrollGalleryRight() {
        scrollContainer.scrollBy({ left: 250, behavior: 'smooth' });
    }
</script>

{% endblock scripts %}